name: Release Binaries

on:
  pull_request:
    types:
      - closed

jobs:
  build:
    if: github.event.pull_request.merged == true
    uses: ./.github/workflows/build.yml
  create-release:
    if: github.event.pull_request.merged == true
    permissions:
      contents: write
    runs-on: ubuntu-latest
    needs:
      - build
    steps:
      - id: info
        run: |
          DATE=$(date +%Y%m%d%H%M%S)
          echo "date=$DATE" >> $GITHUB_OUTPUT
      - uses: actions/download-artifact@v4
        with:
          name: zeppelin-iginx
      - uses: actions/checkout@v4
      - uses: ncipollo/release-action@v1
        with:
          name: Automated Release ${{ github.run_id }}
          commit: main
          tag: v${{ github.run_id }}
          artifacts: |
            *.jar
            README.md
          prerelease: true
          allowUpdates: true
          generateReleaseNotes: true